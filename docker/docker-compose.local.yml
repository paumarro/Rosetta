# Rosetta Platform - Local Development (Lightweight)
# ==================================================
# Use with: docker compose -f docker-compose.yml -f docker-compose.local.yml up
#
# PURPOSE: Run only infrastructure (nginx, databases) in Docker,
#          while running application services locally on your machine.
#
# WHY USE THIS?
#   - Faster iteration: No Docker rebuild for code changes
#   - Better debugging: Full IDE integration, breakpoints work natively
#   - Lower resource usage: Only databases in containers
#   - Matches how most developers work day-to-day
#
# WORKFLOW:
#   1. Start infrastructure: docker compose -f docker-compose.yml -f docker-compose.local.yml up
#   2. Run services locally:
#      - Terminal 1: cd FE && npm run dev
#      - Terminal 2: cd fe-editor && npm run dev
#      - Terminal 3: cd BE && go run cmd/main.go
#      - Terminal 4: cd be-editor && npm run dev
#      - Terminal 5: cd auth-service && go run cmd/main.go
#
# host.docker.internal EXPLAINED:
#   Docker containers are isolated - they can't reach "localhost" on your Mac.
#   "host.docker.internal" is a special DNS name that resolves to your host machine.
#   This lets nginx (in Docker) proxy to services running outside Docker.

services:
  # ─────────────────────────────────────────────────────────────────────────────
  # NGINX - Proxy to local services via host.docker.internal
  # ─────────────────────────────────────────────────────────────────────────────
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      # Use special local nginx config that routes to host machine
      - ./nginx/nginx.local.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on: []  # No container dependencies - services run locally
    extra_hosts:
      # This makes "host.docker.internal" resolve to the host machine
      # Built-in on Docker Desktop for Mac/Windows, needed on Linux
      - "host.docker.internal:host-gateway"
    networks:
      - rosetta

  # ─────────────────────────────────────────────────────────────────────────────
  # Disable all application services (they run locally)
  # Using profiles to exclude from default startup
  # ─────────────────────────────────────────────────────────────────────────────
  frontend:
    profiles: ["disabled"]

  fe-editor:
    profiles: ["disabled"]

  backend:
    profiles: ["disabled"]

  be-editor:
    profiles: ["disabled"]

  auth-service:
    profiles: ["disabled"]

  # ─────────────────────────────────────────────────────────────────────────────
  # DATABASES - Keep in Docker for easy setup/teardown
  # Expose ports so local services can connect
  # ─────────────────────────────────────────────────────────────────────────────
  mongodb:
    ports:
      - "27017:27017"

  postgres:
    ports:
      - "5432:5432"
