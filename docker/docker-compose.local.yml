# Rosetta Platform - Local Development (Frontend Hot-Reload)
# ==================================================
# Use with: docker compose -f docker-compose.yml -f docker-compose.local.yml up
#
# PURPOSE: Run only FRONTENDS locally for fast hot-reload during UI development.
#          Backends, databases, and nginx remain in Docker.
#
# WHY USE THIS?
#   - Frontend hot-reload: See UI changes instantly without Docker rebuild
#   - Simpler setup: Backends already need databases (which run in Docker)
#   - Fewer moving parts: Only frontends run locally
#
# WORKFLOW:
#   1. Start infrastructure and backends: docker compose -f docker-compose.yml -f docker-compose.local.yml up
#   2. Run frontends locally (separate terminals):
#      - Terminal 1: cd apps/frontend && npm run dev          # Port 3000
#      - Terminal 2: cd apps/frontend-editor && npm run dev   # Port 5173
#
# host.docker.internal EXPLAINED:
#   Docker containers are isolated - they can't reach "localhost" on your Mac.
#   "host.docker.internal" is a special DNS name that resolves to your host machine.
#   This lets nginx (in Docker) proxy to services running outside Docker.

services:
  # ─────────────────────────────────────────────────────────────────────────────
  # NGINX - Proxy to local services via host.docker.internal
  # ─────────────────────────────────────────────────────────────────────────────
  nginx:
    volumes:
      # Use special local nginx config that routes to host machine
      - ./nginx/nginx.local.conf:/etc/nginx/conf.d/default.conf:ro
    extra_hosts:
      # This makes "host.docker.internal" resolve to the host machine
      # Built-in on Docker Desktop for Mac/Windows, needed on Linux
      - "host.docker.internal:host-gateway"

  # ─────────────────────────────────────────────────────────────────────────────
  # Disable frontend services (they run locally)
  # ─────────────────────────────────────────────────────────────────────────────
  frontend:
    profiles: ["disabled"]

  fe-editor:
    profiles: ["disabled"]

  # ─────────────────────────────────────────────────────────────────────────────
  # Backend-Editor - Enable test mode for collaborative editing tests
  # NODE_ENV=development enables the TestUserProvider bypass in wsAuth
  # ─────────────────────────────────────────────────────────────────────────────
  be-editor-1:
    environment:
      - NODE_ENV=development

  be-editor-2:
    environment:
      - NODE_ENV=development

  be-editor-3:
    environment:
      - NODE_ENV=development

  # ─────────────────────────────────────────────────────────────────────────────
  # DATABASES - Keep in Docker for easy setup/teardown
  # Expose ports so local services can connect
  # ─────────────────────────────────────────────────────────────────────────────
  mongodb:
    ports:
      - "27017:27017"

  postgres:
    ports:
      - "5432:5432"
